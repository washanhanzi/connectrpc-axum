[config]
default_to_workspace = false
skip_core_tasks = true

# ============================================================================
# Example Rust Servers
# ============================================================================

[tasks.run-connect-unary]
description = "Run Example 1: Pure ConnectRPC unary"
category = "Rust Servers"
command = "cargo"
args = ["run", "--bin", "connect-unary"]

[tasks.run-connect-server-stream]
description = "Run Example 2: Pure ConnectRPC server streaming"
category = "Rust Servers"
command = "cargo"
args = ["run", "--bin", "connect-server-stream"]

[tasks.run-tonic-unary]
description = "Run Example 3: Tonic gRPC unary (Connect + gRPC)"
category = "Rust Servers"
command = "cargo"
args = ["run", "--bin", "tonic-unary"]

[tasks.run-tonic-server-stream]
description = "Run Example 4: Tonic server streaming (Connect + gRPC)"
category = "Rust Servers"
command = "cargo"
args = ["run", "--bin", "tonic-server-stream"]

[tasks.run-tonic-bidi-stream]
description = "Run Example 5: Tonic bidi streaming (gRPC only)"
category = "Rust Servers"
command = "cargo"
args = ["run", "--bin", "tonic-bidi-stream"]

[tasks.run-grpc-web]
description = "Run Example 6: gRPC-Web via tonic-web"
category = "Rust Servers"
command = "cargo"
args = ["run", "--bin", "grpc-web", "--features", "tonic-web"]

[tasks.build-servers]
description = "Build all example servers"
category = "Rust Servers"
command = "cargo"
args = ["build", "--bins", "--features", "tonic-web"]

# ============================================================================
# Go Client Tasks
# ============================================================================

[tasks.go-generate]
description = "Generate Go protobuf code from .proto files (using buf managed mode)"
category = "Go Client"
script = ["buf generate"]

[tasks.go-deps]
description = "Download Go dependencies"
category = "Go Client"
cwd = "go-client"
command = "go"
args = ["mod", "tidy"]

[tasks.go-build-client]
description = "Build the Go test client"
category = "Go Client"
cwd = "go-client"
command = "go"
args = ["build", "-o", "go-client", "./cmd/client"]
dependencies = ["go-generate"]

[tasks.go-build-server]
description = "Build the Go reference server"
category = "Go Server"
cwd = "go-server"
command = "go"
args = ["build", "-o", "go-server", "."]
dependencies = ["go-generate"]

[tasks.go-server-deps]
description = "Download Go server dependencies"
category = "Go Server"
cwd = "go-server"
command = "go"
args = ["mod", "tidy"]

[tasks.go-build]
description = "Build both Go client and server"
category = "Go Client"
dependencies = ["go-build-client", "go-build-server"]
